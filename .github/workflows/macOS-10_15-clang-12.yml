name: macOS 10.15 AppleClang 12
on:
  push:
    branches:
      - master
      - develop
  pull_request:
    branches:
      - master
      - develop
jobs:
  Build-Rodin:
    runs-on: macos-10.15
    env:
      MAKEFLAGS: "-j2"
    steps:
      - name: Checkout repository and submodules
        uses: actions/checkout@v2
        with:
          submodules: recursive
      - name: Install dependencies
        run: >-
          brew update && brew install
          mesalib-glw
          lcov
          sdl2
          glfw
          openal-soft
          vulkan-headers
          molten-vk
          suitesparse
          boost
      - name: Configure CMake
        run: >
          cmake
          -B ${{github.workspace}}/build
          -DCMAKE_BUILD_TYPE=Release
          -DRODIN_BUILD_DOC=OFF
          -DRODIN_USE_MCSS=OFF
          -DRODIN_BUILD_SRC=ON
          -DRODIN_BUILD_EXAMPLES=ON
      - name: Build
        run: cmake --build ${{github.workspace}}/build
  Generate-Badge:
      if: ${{ always() && github.ref == 'refs/heads/master' }}
      needs: Build-Rodin
      runs-on: ubuntu-latest
      steps:
        - name: Generate succesful build badge
          if: needs.Build-Rodin.result == 'success'
          uses: RubbaBoy/BYOB@v1.2.1
          with:
            NAME: macOS-10_15-clang-12-build_badge
            LABEL: 'build'
            STATUS: 'success'
            COLOR: 50C828
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        - name: Generate failing build badge
          if: needs.Build-Rodin.result == 'failure'
          uses: RubbaBoy/BYOB@v1.2.1
          with:
            NAME: macOS-10_15-clang-12-build_badge
            LABEL: 'build'
            STATUS: 'failure'
            COLOR: red
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        - name: Generate cancelled build badge
          if: needs.Build-Rodin.result == 'cancelled'
          uses: RubbaBoy/BYOB@v1.2.1
          with:
            NAME: macOS-10_15-clang-12-build_badge
            LABEL: 'build'
            STATUS: 'cancelled'
            COLOR: 9B9B9B
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        - name: Generate skipped build badge
          if: needs.Build-Rodin.result == 'skipped'
          uses: RubbaBoy/BYOB@v1.2.1
          with:
            NAME: macOS-10_15-clang-12-build_badge
            LABEL: 'build'
            STATUS: 'skipped'
            COLOR: D9AE2D
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

